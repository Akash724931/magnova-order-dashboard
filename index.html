<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magnova 3D Dashboard</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;background:#0f0f23;color:#fff;overflow-x:hidden}.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.3)}h1{font-size:2.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.nav{display:flex;justify-content:center;gap:15px;margin-top:15px;flex-wrap:wrap}.nav-btn{padding:12px 25px;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);border-radius:8px;color:#fff;cursor:pointer;font-weight:600;transition:all 0.3s;backdrop-filter:blur(10px)}.nav-btn:hover,.nav-btn.active{background:rgba(255,255,255,0.4);transform:translateY(-2px);box-shadow:0 4px 15px rgba(255,255,255,0.2)}.upload-zone{background:rgba(255,193,7,0.1);border:3px dashed #ffc107;border-radius:12px;padding:30px;margin:20px;text-align:center;cursor:pointer;transition:all 0.3s}.upload-zone:hover{background:rgba(255,193,7,0.2);border-color:#ffeb3b}.upload-zone input{display:none}.upload-label{font-size:1.2em;color:#ffc107;font-weight:600}.file-list{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:15px}.file-tag{background:#28a745;padding:8px 15px;border-radius:20px;font-size:0.9em}.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:20px;padding:20px}.card{background:rgba(255,255,255,0.05);border-radius:15px;padding:20px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1);box-shadow:0 8px 32px rgba(0,0,0,0.3)}.card h2{color:#667eea;margin-bottom:15px;font-size:1.5em}.chart-container{height:400px;width:100%}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;padding:20px}.stat-card{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:25px;border-radius:12px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:transform 0.3s}.stat-card:hover{transform:scale(1.05)}.stat-card h3{font-size:0.9em;opacity:0.9;margin-bottom:10px}.stat-card p{font-size:2.2em;font-weight:bold}.table-wrapper{overflow-x:auto;margin-top:15px;max-height:600px}.data-table{width:100%;border-collapse:collapse;font-size:0.85em}.data-table th{background:rgba(102,126,234,0.3);padding:12px 8px;text-align:left;border-bottom:2px solid #667eea;position:sticky;top:0;z-index:10}.data-table td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,0.1);white-space:nowrap}.data-table tr:hover{background:rgba(255,255,255,0.05)}.badge{padding:5px 12px;border-radius:15px;font-size:0.85em;font-weight:600}.badge-pending{background:#ffc107;color:#000}.badge-completed{background:#28a745}.badge-reserved{background:#17a2b8}.controls{padding:20px;display:flex;gap:10px;flex-wrap:wrap;background:rgba(255,255,255,0.05);border-radius:10px;margin:20px}.control-input{padding:10px 15px;border:2px solid rgba(255,255,255,0.2);border-radius:6px;background:rgba(255,255,255,0.1);color:#fff;font-size:14px}.control-input:focus{outline:none;border-color:#667eea}.btn{padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5568d3}.btn-success{background:#28a745;color:#fff}.btn-success:hover{background:#218838}.hidden{display:none}
</style>
</head>
<body>
<div class="header">
<h1>üìä Magnova 3D Analytics Dashboard</h1>
<div class="nav">
<button class="nav-btn active" onclick="showTab('overview')">Overview</button>
<button class="nav-btn" onclick="showTab('sales')">Sales Analysis</button>
<button class="nav-btn" onclick="showTab('purchase')">Purchase</button>
<button class="nav-btn" onclick="showTab('billing')">Billing Plan</button>
<button class="nav-btn" onclick="showTab('inventory')">Inventory</button>
<button class="nav-btn" onclick="showTab('pricing')">Pricing</button>
</div>
</div>

<div class="upload-zone" onclick="document.getElementById('multiFileInput').click()">
<input type="file" id="multiFileInput" multiple accept=".xlsx,.xls,.csv">
<div class="upload-label">üìÅ Upload Multiple Excel Files</div>
<p style="color:#aaa;margin-top:10px">Sales Orders ‚Ä¢ Purchase Invoices ‚Ä¢ Stock Data ‚Ä¢ Billing Plans</p>
<div class="file-list" id="fileList"></div>
</div>

<div id="overview" class="tab-content">
<div class="stats-grid">
<div class="stat-card"><h3>Total Orders</h3><p id="totalOrders">0</p></div>
<div class="stat-card"><h3>Pending Orders</h3><p id="pendingOrders">0</p></div>
<div class="stat-card"><h3>Total Revenue</h3><p id="totalRevenue">‚Çπ0</p></div>
<div class="stat-card"><h3>Pending Value</h3><p id="pendingValue">‚Çπ0</p></div>
<div class="stat-card"><h3>Customers</h3><p id="customersCount">0</p></div>
<div class="stat-card"><h3>Avg Order Value</h3><p id="avgOrderValue">‚Çπ0</p></div>
</div>

<div class="dashboard">
<div class="card">
<h2>üìà Top 10 Customers by Value</h2>
<div id="customerChart" class="chart-container"></div>
</div>
<div class="card">
<h2>üéØ Order Status Distribution</h2>
<div id="orderStatus3D" class="chart-container"></div>
</div>
<div class="card">
<h2>üë§ Sales Person Performance</h2>
<div id="salesPersonChart" class="chart-container"></div>
</div>
<div class="card">
<h2>üì¶ Category Distribution</h2>
<div id="categoryChart" class="chart-container"></div>
</div>
</div>
</div>

<div id="sales" class="tab-content hidden">
<div class="controls">
<input type="text" class="control-input" placeholder="Search orders, customers, items..." id="salesSearch" onkeyup="filterSales()">
<select class="control-input" id="salesFilter" onchange="filterSales()">
<option value="all">All Status</option>
<option value="pending">Pending Only</option>
<option value="completed">Completed Only</option>
</select>
<button class="btn btn-success" onclick="exportData('sales')">üì• Export Sales</button>
</div>
<div class="card">
<h2>Sales Order Items Report (<span id="salesCount">0</span> records)</h2>
<div class="table-wrapper">
<table class="data-table" id="salesTable">
<thead><tr><th>Order No</th><th>PO Number</th><th>Customer</th><th>Item</th><th>Order Qty</th><th>Delivered</th><th>Pending</th><th>Rate</th><th>Value Before</th><th>Pending Value</th><th>Sales Person</th><th>Category</th><th>Status</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<div id="purchase" class="tab-content hidden">
<div class="card">
<h2>Purchase Order Items (<span id="purchaseCount">0</span> records)</h2>
<div class="table-wrapper">
<table class="data-table" id="purchaseTable">
<thead><tr><th>Order No</th><th>PO Number</th><th>Customer</th><th>Item</th><th>Qty</th><th>Rate</th><th>Amount</th><th>Remarks</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<div id="billing" class="tab-content hidden">
<div class="card">
<h2>üìã Billing Plan (<span id="billingCount">0</span> records)</h2>
<div class="table-wrapper">
<table class="data-table" id="billingTable">
<thead><tr><th>Order</th><th>Customer</th><th>Item</th><th>Amount</th><th>Date</th><th>Status</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<div id="inventory" class="tab-content hidden">
<div class="card">
<h2>üì¶ Stock Register (<span id="inventoryCount">0</span> items)</h2>
<div class="table-wrapper">
<table class="data-table" id="inventoryTable">
<thead><tr><th>Item</th><th>Description</th><th>Qty</th><th>Rate</th><th>Value</th><th>Details</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<div id="pricing" class="tab-content hidden">
<div class="card">
<h2>üíµ Invoice Items (<span id="invoiceCount">0</span> records)</h2>
<div class="table-wrapper">
<table class="data-table" id="pricingTable">
<thead><tr><th>Invoice No</th><th>Customer</th><th>Item</th><th>Qty</th><th>Rate</th><th>Amount</th><th>Date</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<script>
let allData={sales:[],purchase:[],billing:[],inventory:[],invoice:[]};
let filteredSales=[];

function getVal(obj,keys){for(let k of keys){if(obj[k]!==undefined&&obj[k]!==null&&obj[k]!=='')return obj[k]}return 0}
function getStr(obj,keys){for(let k of keys){if(obj[k])return obj[k]}return ''}

function showTab(tab){document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));document.getElementById(tab).classList.remove('hidden');document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active')}

document.getElementById('multiFileInput').addEventListener('change',function(e){const files=e.target.files;const fileList=document.getElementById('fileList');fileList.innerHTML='';let processed=0;Array.from(files).forEach(file=>{const tag=document.createElement('div');tag.className='file-tag';tag.textContent=file.name;fileList.appendChild(tag);const reader=new FileReader();reader.onload=function(evt){try{const data=new Uint8Array(evt.target.result);const wb=XLSX.read(data,{type:'array'});const ws=wb.Sheets[wb.SheetNames[0]];const json=XLSX.utils.sheet_to_json(ws);const fname=file.name.toLowerCase();if(fname.includes('sales')&&fname.includes('order')&&fname.includes('item')){allData.sales=allData.sales.concat(json);console.log('Sales loaded:',json.length)}else if(fname.includes('purchase')&&fname.includes('order')){allData.purchase=json;console.log('Purchase loaded:',json.length)}else if(fname.includes('billing')||fname.includes('plan')){allData.billing=json}else if(fname.includes('register')){allData.inventory=json}else if(fname.includes('invoice')){allData.invoice=json}processed++;if(processed===files.length){processAllData()}}catch(err){console.error('Error:',err)}};reader.readAsArrayBuffer(file)})});

function processAllData(){console.log('Processing',allData.sales.length,'sales records');updateStats();render3DCharts();renderAllTables();filteredSales=[...allData.sales];filterSales()}

function updateStats(){const sales=allData.sales;const total=sales.length;let pending=0,totalRev=0,pendingVal=0;sales.forEach(o=>{const pend=parseFloat(getVal(o,['Pending','Pending Rate','Pending Qty']));const val=parseFloat(getVal(o,['Value Before','Total Value','Value','Amount']));const pendVal=parseFloat(getVal(o,['Pending D.','Pending Value','Pending Amount']));if(pend>0)pending++;totalRev+=val;pendingVal+=pendVal});const customers=new Set(sales.map(o=>getStr(o,['Customer','Customer Name']))).size;const avgOrder=total>0?totalRev/total:0;document.getElementById('totalOrders').textContent=total;document.getElementById('pendingOrders').textContent=pending;document.getElementById('totalRevenue').textContent='‚Çπ'+(totalRev/100000).toFixed(2)+'L';document.getElementById('pendingValue').textContent='‚Çπ'+(pendingVal/100000).toFixed(2)+'L';document.getElementById('customersCount').textContent=customers;document.getElementById('avgOrderValue').textContent='‚Çπ'+(avgOrder/1000).toFixed(1)+'K'}

function render3DCharts(){const sales=allData.sales;if(sales.length===0)return;const customerRevenue={};sales.forEach(o=>{const cust=getStr(o,['Customer','Customer Name'])||'Unknown';const val=parseFloat(getVal(o,['Value Before','Total Value','Value']));customerRevenue[cust]=(customerRevenue[cust]||0)+val});const topCustomers=Object.entries(customerRevenue).sort((a,b)=>b[1]-a[1]).slice(0,10);Plotly.newPlot('customerChart',[{x:topCustomers.map(c=>c[0]),y:topCustomers.map(c=>c[1]),type:'bar',marker:{color:'#667eea'}}],{paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#fff'},xaxis:{title:'Customer'},yaxis:{title:'Revenue (‚Çπ)'}},{responsive:true});

let pendingCount=0,completedCount=0;sales.forEach(o=>{const pend=parseFloat(getVal(o,['Pending','Pending Rate','Pending Qty']));if(pend>0)pendingCount++;else completedCount++});Plotly.newPlot('orderStatus3D',[{values:[pendingCount,completedCount],labels:['Pending','Completed'],type:'pie',hole:0.4,marker:{colors:['#ffc107','#28a745']},textfont:{color:'#fff',size:14}}],{paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#fff'}},{responsive:true});

const salesPersonRev={};sales.forEach(o=>{const sp=getStr(o,['Item Descript Sales Person','Sales Person','Salesperson'])||'Unknown';const val=parseFloat(getVal(o,['Value Before','Total Value','Value']));salesPersonRev[sp]=(salesPersonRev[sp]||0)+val});const topSP=Object.entries(salesPersonRev).sort((a,b)=>b[1]-a[1]).slice(0,10);Plotly.newPlot('salesPersonChart',[{x:topSP.map(s=>s[0]),y:topSP.map(s=>s[1]),type:'bar',marker:{color:'#764ba2'}}],{paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#fff'},xaxis:{title:'Sales Person'},yaxis:{title:'Revenue (‚Çπ)'}},{responsive:true});

const categories={};sales.forEach(o=>{const cat=getStr(o,['Item Category','Sales Category','Category'])||'Other';categories[cat]=(categories[cat]||0)+1});Plotly.newPlot('categoryChart',[{values:Object.values(categories),labels:Object.keys(categories),type:'pie',marker:{colors:['#667eea','#764ba2','#28a745','#ffc107','#17a2b8']},textfont:{color:'#fff'}}],{paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#fff'}},{responsive:true})}

function renderAllTables(){renderSalesTable();renderPurchaseTable();renderBillingTable();renderInventoryTable();renderInvoiceTable()}

function renderSalesTable(){const tbody=document.querySelector('#salesTable tbody');if(filteredSales.length===0){tbody.innerHTML='<tr><td colspan="13" style="text-align:center;padding:30px;color:#aaa">No sales data</td></tr>';return}tbody.innerHTML=filteredSales.slice(0,200).map(o=>{const orderNo=getStr(o,['Order No','Sl. No','SO Number']);const poNum=getStr(o,['PO Number','PO No']);const customer=getStr(o,['Customer','Customer Name']);const item=getStr(o,['Item Name','Item','Product']);const orderQty=getVal(o,['Order Delivery','Order Qty','Quantity']);const delivered=getVal(o,['Delivered','Delivered Qty']);const pending=getVal(o,['Pending','Pending Rate','Pending Qty']);const rate=getVal(o,['Rate','Unit Rate','Price']);const valueBefore=getVal(o,['Value Before','Total Value','Value']);const pendingValue=getVal(o,['Pending D.','Pending Value','Pending Amount']);const salesPerson=getStr(o,['Item Descript Sales Person','Sales Person']);const category=getStr(o,['Item Category','Sales Category','Category']);const isPending=parseFloat(pending)>0;return `<tr><td><strong>${orderNo}</strong></td><td>${poNum}</td><td>${customer}</td><td>${item}</td><td>${orderQty}</td><td>${delivered}</td><td><strong>${pending}</strong></td><td>‚Çπ${parseFloat(rate).toLocaleString()}</td><td>‚Çπ${parseFloat(valueBefore).toLocaleString()}</td><td><strong>‚Çπ${parseFloat(pendingValue).toLocaleString()}</strong></td><td>${salesPerson}</td><td>${category}</td><td><span class="badge ${isPending?'badge-pending':'badge-completed'}">${isPending?'Pending':'Done'}</span></td></tr>`}).join('');document.getElementById('salesCount').textContent=filteredSales.length}

function renderPurchaseTable(){const tbody=document.querySelector('#purchaseTable tbody');const data=allData.purchase;if(data.length===0){tbody.innerHTML='<tr><td colspan="8" style="text-align:center;padding:30px;color:#aaa">Upload Purchase file</td></tr>';return}tbody.innerHTML=data.slice(0,100).map(o=>`<tr><td>${getStr(o,['Order No','SO Number'])}</td><td>${getStr(o,['PO Number','PO No'])}</td><td>${getStr(o,['Customer','Vendor'])}</td><td>${getStr(o,['Item Name','Item'])}</td><td>${getVal(o,['Qty','Quantity'])}</td><td>‚Çπ${parseFloat(getVal(o,['Rate','Price'])).toLocaleString()}</td><td>‚Çπ${parseFloat(getVal(o,['Amount','Value'])).toLocaleString()}</td><td>${getStr(o,['Remarks','Notes'])}</td></tr>`).join('');document.getElementById('purchaseCount').textContent=data.length}

function renderBillingTable(){const tbody=document.querySelector('#billingTable tbody');const data=allData.billing;if(data.length===0){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:30px;color:#aaa">Upload Billing file</td></tr>';return}tbody.innerHTML=data.slice(0,100).map(o=>`<tr><td>${getStr(o,['Order No','SO'])}</td><td>${getStr(o,['Customer'])}</td><td>${getStr(o,['Item Name','Item'])}</td><td>‚Çπ${parseFloat(getVal(o,['Amount','Value'])).toLocaleString()}</td><td>${getStr(o,['Date','Plan Date'])}</td><td><span class="badge badge-pending">Scheduled</span></td></tr>`).join('');document.getElementById('billingCount').textContent=data.length}

function renderInventoryTable(){const tbody=document.querySelector('#inventoryTable tbody');const data=allData.inventory;if(data.length===0){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:30px;color:#aaa">Upload Stock file</td></tr>';return}tbody.innerHTML=data.slice(0,100).map(o=>`<tr><td>${getStr(o,['Item','Item Name'])}</td><td>${getStr(o,['Description','Item Description'])}</td><td>${getVal(o,['Qty','Quantity'])}</td><td>‚Çπ${parseFloat(getVal(o,['Rate','Price'])).toLocaleString()}</td><td>‚Çπ${parseFloat(getVal(o,['Value','Amount'])).toLocaleString()}</td><td>${getStr(o,['Location','Warehouse'])}</td></tr>`).join('');document.getElementById('inventoryCount').textContent=data.length}

function renderInvoiceTable(){const tbody=document.querySelector('#pricingTable tbody');const data=allData.invoice;if(data.length===0){tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:30px;color:#aaa">Upload Invoice file</td></tr>';return}tbody.innerHTML=data.slice(0,100).map(o=>`<tr><td>${getStr(o,['Invoice No','Invoice'])}</td><td>${getStr(o,['Customer'])}</td><td>${getStr(o,['Item','Item Name'])}</td><td>${getVal(o,['Qty','Quantity'])}</td><td>‚Çπ${parseFloat(getVal(o,['Rate','Price'])).toLocaleString()}</td><td>‚Çπ${parseFloat(getVal(o,['Amount','Value'])).toLocaleString()}</td><td>${getStr(o,['Date'])}</td></tr>`).join('');document.getElementById('invoiceCount').textContent=data.length}

function filterSales(){const search=document.getElementById('salesSearch').value.toLowerCase();const status=document.getElementById('salesFilter').value;filteredSales=allData.sales.filter(o=>{const matchSearch=!search||JSON.stringify(o).toLowerCase().includes(search);const pend=parseFloat(getVal(o,['Pending','Pending Rate','Pending Qty']));const matchStatus=status==='all'||(status==='pending'&&pend>0)||(status==='completed'&&pend===0);return matchSearch&&matchStatus});renderSalesTable()}

function exportData(type){const data=type==='sales'?filteredSales:allData[type];if(data.length===0)return alert('No data');const csv=[Object.keys(data[0]).join(','),...data.map(row=>Object.values(row).map(v=>typeof v==='string'&&v.includes(',')?`"${v}"`:v).join(','))].join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`magnova-${type}-${new Date().toISOString().split('T')[0]}.csv`;a.click()}
</script>
</body>
</html>